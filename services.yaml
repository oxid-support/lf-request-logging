parameters:
    oxs.request_logger.cookie_name: 'X-Correlation-Id'
    oxs.request_logger.header_name: 'X-Correlation-Id'
    oxs.request_logger.ttl: 2592000 # 30 days in seconds

services:

    _defaults:
        autowire: true
        public: false

    OxidSupport\RequestLogger\Logger\LoggerFactory: ~

    oxs.logger.channel:
        class: Monolog\Logger
        factory: ['@OxidSupport\RequestLogger\Logger\LoggerFactory', 'create']

    OxidSupport\RequestLogger\ShopRequestRecorder\ShopRequestRecorder:
        arguments:
            $logger: '@oxs.logger.channel'

    OxidSupport\RequestLogger\ShopRequestRecorder\ShopRequestRecorderInterface:
        alias: OxidSupport\RequestLogger\ShopRequestRecorder\ShopRequestRecorder
        public: true

    OxidSupport\RequestLogger\CorrelationId\CorrelationIdProviderInterface:
        class: OxidSupport\RequestLogger\CorrelationId\CorrelationIdProvider

    OxidSupport\RequestLogger\CorrelationId\CorrelationIdGeneratorInterface:
        class: OxidSupport\RequestLogger\CorrelationId\CorrelationIdGenerator

    OxidSupport\RequestLogger\Logger\Processor\CorrelationIdProcessorInterface:
        class: OxidSupport\RequestLogger\Logger\Processor\CorrelationIdProcessor

    OxidSupport\RequestLogger\CorrelationId\Emitter\Decorator\OnceEmitterDecorator: ~

    OxidSupport\RequestLogger\CorrelationId\Emitter\EmitterInterface:
        alias: OxidSupport\RequestLogger\CorrelationId\Emitter\Decorator\OnceEmitterDecorator

    OxidSupport\RequestLogger\CorrelationId\Emitter\CookieEmitter:
        arguments:
            $cookieName: '%oxs.request_logger.cookie_name%'
            $ttl: '%oxs.request_logger.ttl%'
        tags: ['oxs.cid.emitter']

    OxidSupport\RequestLogger\CorrelationId\Emitter\HeaderEmitter:
        arguments:
            $headerName: '%oxs.request_logger.header_name%'
        tags: ['oxs.cid.emitter']

    OxidSupport\RequestLogger\CorrelationId\Emitter\Composite\CompositeEmitter:
        arguments:
            $emitters: !tagged_iterator 'oxs.cid.emitter'

    OxidSupport\RequestLogger\CorrelationId\Resolver\ResolverInterface:
        alias: OxidSupport\RequestLogger\CorrelationId\Resolver\Composite\CompositeResolver

    OxidSupport\RequestLogger\CorrelationId\Resolver\CookieResolver:
        arguments:
            $cookieName: '%oxs.request_logger.cookie_name%'
        tags:
            - { name: 'oxs.cid.resolver', priority: 100 }

    OxidSupport\RequestLogger\CorrelationId\Resolver\HeaderResolver:
        arguments:
            $headerName: '%oxs.request_logger.header_name%'
        tags:
            - { name: 'oxs.cid.resolver', priority: 190 }

    OxidSupport\RequestLogger\CorrelationId\Resolver\Composite\CompositeResolver:
        arguments:
            $resolvers: !tagged_iterator 'oxs.cid.resolver'
